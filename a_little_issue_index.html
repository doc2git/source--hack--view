<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Edit code here, view the output write away!</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!--<link rel="stylesheet" href="//cdn.bootcss.com/bootstrap/3.3.7/css/bootstrap.min.css">-->
    <!--<script src="./codemirror.min.js"></script>-->
    <!--<link rel="stylesheet" href="//cdn.bootcss.com/codemirror/5.2.0/codemirror.min.css">-->
    <!--<script src="./htmlmixed.min.js"></script>-->
    <!--<script src="./css.min.js"></script>-->
    <!--<script src="./javascript.min.js"></script>-->
    <!--<script src="./xml.min.js"></script>-->
    <!--<script src="./closetag.min.js"></script>-->
    <!--<script src="./closebrackets.min.js"></script>-->
    <!--&lt;!&ndash;[if lt IE 9]>-->
    <!--<script src="./html5.min.js"></script>-->
    <!--<![endif]&ndash;&gt;-->
    <!--&lt;!&ndash;Next script is wrote by doc2git, which is writing for fix the js pulubic function demensions of element. It will be call when Dom loaded by mind.&ndash;&gt;-->
    <style>
        * {
            margin: 0;
            padding: 0;
        }

        .disabled {
            background-color: gray;
        }
    </style>
    <script data-hacker="doc2git">


        String.prototype.trim = function () {
            return this.replace(/(^\s+|\s+$)/, '');
        }

        document.addEventListener('DOMContentLoaded', function () {

            var turtorIframe = document.getElementById('turtor-iframe');
            console.log(turtorIframe, '35---');
            var turtorNavbar = document.getElementById('turtor-navbar');
            var prev = document.getElementById('prev');
//            console.log(turtorNavbar.index, '42---');
            var next = document.getElementById('next');
            turtorNavbar.histories = [];
            turtorNavbar.prevNavDirections = 'next';
            turtorNavbar.curNavDirections = 'null';
            console.log(turtorNavbar, turtorNavbar.histories, '37+++');

            //以下使用链式数据结构为iframe添加浏览历史记录
            function History(uri = 'http://doc2git.com'.trim(), id = turtorNavbar.histories.length, valid = true) {
                this.uri = uri;
                this.id = id;
                this.valid = valid;
//                prev = prev || null;
//                value = value || '';
//                next = next || null;
//                return {value: value, prev: prev, next: next};
                /*
                 * instance is look lick this:
                 * {
                 *   prev: {prev:prev-prev, prev-value, this-instance}
                 *   value: 'this-value',
                 *   next: {this-instance, next-value, next-next}
                 * }
                * */
            };
            turtorNavbar.cur = turtorNavbar.histories[0] = new History();

            turtorNavbar.iframeTo = function () {
                //turtorIframe.src = this.history.cur; //设定教程iframe的src
                console.log(turtorIframe, '62---');
                console.log(this.cur.uri, '64---');
                console.log(turtorIframe, '73---');
                turtorIframe.src = this.cur.uri; //设定教程iframe的src

                console.log(turtorIframe.src, '75---');
            };
            console.log(turtorNavbar.iframeTo, '59---');


            turtorNavbar.handleNavBtnClassName = function () {
//                ev.target.className = ev.target.className ? ev.target.className + ' disabled' : 'disabled';
                function removeDisabledClass(ele) {
                    ele.className = ele.className.replace(/\bdisabled\b/, '').replace(/\s+/, ' ').replace(/(^\s+|\s+$)/, '');
                    console.log(ele.className, '78---');
                }

                console.log(prev, next, '80---');
                removeDisabledClass(prev);
                removeDisabledClass(next);
                console.log(this, '95---');
                if (this.index <= 0) !(/\bdisabled\b/.test(prev.className)) ? (prev.className += ' disabled') : null;
                if (this.index >= this.histories.length - 1) !(/\bdisabled\b/.test(next.className)) ? (next.className += ' disabled') : null;
                console.log(prev.className, next.className, '86---');
            }

            turtorNavbar.uriAttemptTo = function (uriAnyMore=true) {
                this.handleNavBtnClassName();
                console.log(this.histories, '99---', this.index);
//                console.log(this.cur, '100---');
                if (uriAnyMore) {
                    this.iframeTo();
                } else {
                    alert('No more url in this side of history.');
                }
            }

            //为教程按钮绑定事件以导航教程iframe
            turtorNavbar.uriGo = function () {
                if (this.prevNavDirection !== 'next') this.prevNavDirection = 'next';
                var turtorUrlInput = document.getElementById('turtor-uri-input');
                var goBtn = document.getElementById('go-btn');
                console.log(turtorUrlInput, goBtn, turtorIframe, '32---');
                if (turtorUrlInput.value.trim() !== this.histories[this.histories.length - 1].uri) {
                    console.log('1:', turtorUrlInput.value.trim(), '\n2:', this.histories[this.histories.length - 1].uri, '110---');
                    this.cur = this.histories[this.histories.length] = new History(turtorUrlInput.value.trim(), this.histories.length); //empty object store the old uri.
                    this.index = this.histories.length - 1;
                    console.log(this.cur, '111---');
                    console.log(this.histories, '108---');
//                var item = turtorUrlInput.value;
                    //It looks like that, this centence is non-necessary, but store all History instance into a array, I feel well.
                    //指定以不变的空间地址以存储当前once-history object.
                    console.log(this.cur, '118---');
                    this.uriAttemptTo(); //iframe jump.
                }
            };
            console.log(turtorNavbar.uriGo, '71---');

            function deepCloneObj(oldObj) {
                console.log(oldObj, '94---');
                var temp = JSON.stringify(oldObj);
//                console.log(JSON, '/n-------95---------/n', temp);
//                return JSON.parse(temp);
                console.log(JSON.parse(JSON.stringify(oldObj)), '97---');
                return JSON.parse(JSON.stringify(oldObj));
            }

//
//            function cloneObjLightOrDeep (deep=true, oldObj) {
//                  return deep ? deepCloneObj(oldObj) : oldObj;
//            }

//            turtorNavbar.togglePlaceHolder = function (){
//                var temp = turtorUrlInput.placeholder;
//                turtorUrlInput.placeholder = '没有跟多历史记录了喔 :)';
//                window.setTimeout(function () {
//                    turtorUrlInput.placeholder = temp;
//                }, 2000);
//            }

            turtorNavbar.flashState = function () { //每次刷新教程iframe或修改教程iframe的src前都要执行
                console.log(this.histories, '151---');
                console.log(this.cur, '152---');
//                if (this.index <= 0 || this.index >= this.histories.length) {
//
//                    return void 0;
//                }
                switch (this.curNavDirection) {
                    case 'prev':
                        if(this.index <= 0) return;
                        console.group('testing this.cur');
                        console.log(this.histories, '158---');
//                        this.latest = cloneObjLightOrDeep(reverse, this.histories[this.index - 1]);
                        console.log(this.index, '146---');
                        this.histories[this.histories.length] = deepCloneObj(this.histories[this.index - 1]);
                        console.log(this.cur, '160---');
                        this.cur = this.histories[this.index - 1];
                        this.index--;
                        console.log(this.cur, '161');
                        console.log(this.histories, '165---');
                        console.groupEnd('testing this.cur');
                        break;
                    case 'next':
                        console.group('testing this.histories');
                        if(this.index >= this.histories.length - 1) return;
                        console.log(this.index, '170---');
                        console.log(this.cur, '171---');
//                        this.latest = deepCloneObj(this.histories[this.index + 1]);
                        this.histories[this.histories.length] = deepCloneObj(this.histories[this.index - 1]);
                        this.cur = this.histories[this.index + 1];
                        this.index++;
                        console.log(this.cur, '174---');
                        console.groupEnd('testing this.histories');
                        break;
                    default:
                }
//                this.histories.push(this.latest);
//                var reverse = this.prevNavDirection !== this.curNavDirection;
//                if (reverse) this.cur = this.latest;
                console.log(this.cur, '174---');
                console.log(this.histories, '175---');
            };

            turtorNavbar.uriBack = function (ev) {
                console.log(this, '160---');
                console.log(ev, '145---');
                console.log(this.cur, '176---');
                if (this.index <= 0) { //如果索引为0， 向uriToOrDisable传入false，使后退按钮className as disabled;
                    this.uriAttemptTo(false);
                } else {
                    this.prevNavDirection = this.curNavDirection;
                    this.curNavDirection = 'prev';
                    console.log(this.cur, '186---');
                    Promise.resolve(turtorNavbar.flashState())
                        .then(console.dir(this))
                        .then(console.log(this, this.cur, '188---'))
                        .then(this.uriAttemptTo());
//                    turtorNavbar.flashState();
//                    this.uriAttemptTo();
                }
            };
            console.log(turtorNavbar.uriBack, '85---');

            turtorNavbar.uriForward = function (ev) {
                if (this.index >= this.histories.length - 1) { //如果索引为this.histories.length-1， 向uriToOrDisable传入false，使后退按钮className as disabled;
                    console.log(this.index, '212---');
                    this.uriAttemptTo(false);
                } else {
                    this.prevNavDirection = this.curNavDirection;
                    this.curNavDirection = 'next';
                    Promise.resolve(turtorNavbar.flashState())
                        .then(console.log('214---'))
                        .then(console.log(this.histories, 'past--212-past'))
                        .then(console.log(this.cur, '213---'))
                        .then(this.uriAttemptTo());
                }
            };
            console.log(turtorNavbar.uriForward, '91---');

            ~function initTurtorIframeBar() {
                turtorNavbar.onclick = function (ev) {
                    console.log(95);
                    switch (ev.target.getAttribute('id')) {
                        case 'prev':
                            this.uriBack(ev);
                            break;
                        case 'go-btn':
                            console.log('101, go');
                            this.uriGo(ev);
                            break;
                        case 'next':
                            this.uriForward(ev);
                            break;
                    }
                }
            }();  //教程导航条的定义至此完成

        }, false);
        //
        //
        //        //以下定义在resize函数中执行的修复盒子尺寸的函数
        //        function doc2git_textareaReRender() {
        //            var textarea__panel_body = document.getElementById('doc2git--textarea--panel-body');
        //            var codeMirror__cm_s_default = textarea__panel_body.getElementsByClassName('CodeMirror cm-s-default')[0];
        ////            console.log(codeMirror__cm_s_default, '27---');
        //            codeMirror__cm_s_default.style.height = 'auto';
        //        }
        //
        //        function doc2git_OutputReRender() {
        //            var outputPanelBody = document.getElementById('doc2git--output--panel-body');
        //            var outputIframe = outputPanelBody.getElementsByTagName('iframe')[0];
        //            if (outputIframe) {
        //                outputIframe.style.minHeight = '100px';
        //                outputIframe.style.height = '100px';
        //            }
        //            var iframewrapper = document.getElementById('iframewrapper');
        //            iframewrapper.style.minHeight = '100px';
        //            iframewrapper.style.height = '100px';
        //        }
        //
        //        function doc2git_textareaBoxKeepWidth() {
        //            var textareaBox = document.getElementById('doc2git--texarea-box');
        //            var outputPanelBody = document.getElementById('doc2git--output--panel-body');
        //            var mustWidth = window.getComputedStyle(outputPanelBody).width;
        //            textareaBox.style.width = mustWidth;
        //        }
        //
        //        function doc2git_leftRightBoxKeepDimension() {
        //            var leftBox = document.getElementById('doc2git--left-box');
        //            var rigitBox = document.getElementById('doc2git--right-box');
        //            var mustHeight = window.getComputedStyle(leftBox).height;
        //            rigitBox.style.height = mustHeight;
        //            var mustWidth = window.getComputedStyle(leftBox).width;
        //            rigitBox.style.width = mustWidth;
        //        }
    </script>

    <style>
        body {
            min-height: 300px;
            padding-top: 90px;
            background: #f6f6f6;
        }

        .container {
            width: 98%;
            padding-right: 15px;
            padding-left: 15px;
            margin-right: auto;
            margin-left: auto
        }

        .CodeMirror {
            min-height: 300px;;
            font-family: Menlo, Monaco, Consolas, "Andale Mono", "lucida console", "Courier New", monospace;
        }

        #textareaCode {
            min-height: 260px /*hacked by doc2git*/
        }

        #iframeResult {
            display: block;
            overflow: hidden;
            border: 0 !important;
            min-width: 100px;
            width: 100%;
            min-height: 260px; /*hacked by doc2git*/
            background-color: #fff
        }

        @media screen and (max-width: 768px) {
            #textareaCode {
                height: 300px
            }

            .CodeMirror {
                height: 300px;
                font-family: Menlo, Monaco, Consolas, "Andale Mono", "lucida console", "Courier New", monospace;
            }

            #iframeResult {
                height: 300px
            }

            .form-inline {
                padding: 6px 0 2px 0
            }
        }

        .logo h1 {
            /*background-image: url(/images/logo-domain-white.png);*/
            background-repeat: no-repeat;
            text-indent: -9999px;
            width: 160px;
            height: 39px;
            margin-top: 10px;
            display: block
        }
    </style>
</head>
<body>

<nav class="navbar navbar-default navbar-fixed-top" style="background: #00b0c1;">
    <div class="container">
        <div class="navbar-header logo"><h1>
            <a target="_blank" href="/" style="display: block;">doc2git.com</a></h1>
        </div>
    </div>
</nav>

<div style="height:680px; overflow-y:hidden; margin:0; padding:0" class="container">

    <!--<div class="col-sm-6">-->
    <!--<form class="form-inline">-->
    <!--<div class="form-group mx-sm-10">-->
    <!--<label for="uri" class="sr-only">请键入教程地址</label>-->
    <!--<input type="password" class="form-control" id="uri" placeholder="请键入教程地址">-->
    <!--</div>-->
    <!--</form>-->
    <!--<button class="btn btn-primary">Go</button>-->
    <!--<iframe src="https://cn.vuejs.org/v2/guide/" width="300px" ; height="594px" frameborder="0"></iframe>-->
    <!--</div>-->


    <div id="doc2git--left-box" style="height:100%; display:flex; flex-direction:column; align-content:space-between"
         class="col-sm-6">
        <div style="flex:0" class="panel panel-default">
            <div class="panel-heading">
                <form id="turtor-navbar" style="display:flex; justify-content:space-around" class="form-inline">
                    <!--<label for="uri" class="sr-only">请键入教程地址</label>-->
                    <button id="prev" type="button" class="btn btn-default disabled">B</button>
                    <button id="next" type="button" class="btn btn-default disabled">F</button>
                    <input id="turtor-uri-input" type="text" value="http://localhost:7777" style="width:80%"
                           class="form-control">
                    <button id="go-btn" type="button" class="btn btn-default">GO!</button>

                </form>
            </div>
            <!--<div class="panel-body">-->
            <!--<div id="iframewrapper"></div>-->
            <!--</div>-->
        </div>
        <iframe id="turtor-iframe" src="http://localhost:7776" width="100%" style="flex:1"
                frameborder="0"></iframe>
    </div>

    <div id="doc2git--right-box"
         style="height:100%; display:flex; flex-direction: column; justify-content:space-between; align-items:center; align-content:stretch;"
         class="col-sm-6">

        <!--<div style="flex:1; height:400px; width:100%; display:flex; flex-direction:column; align-content:stretch; justify-content:space-around;" class="panel panel-default">-->
        <div id="doc2git--texarea-box" class="panel panel-default">
            <div class="panel-heading">
                <form class="form-inline">
                    <div class="row">
                        <div class="col-xs-6">
                            <button type="button" class="btn btn-default">源代码：</button>
                        </div>
                        <div class="col-xs-6 text-right">
                            <button type="button" style="background-color:#5fcad5;border-color:#00b2c1" class="btn"
                                    onclick="submitTryit()" id="submitBTN">
                                <span class="glyphicon glyphicon-send"></span> 点击运行
                            </button>
                        </div>
                    </div>
                </form>
            </div>
            <div id="doc2git--textarea--panel-body" style="height:100%" class="panel-body">
			<textarea class="form-control" id="textareaCode" name="textareaCode">&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
&lt;meta charset=&quot;utf-8&quot;&gt;
&lt;title&gt; Enjoy hacking UI and viewing render! &lt;/title&gt;
&lt;script src=&quot;https://unpkg.com/vue/dist/vue.min.js&quot;&gt;&lt;/script&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;div id=&quot;app&quot;&gt;
  &lt;p&gt;{{ message }}&lt;/p&gt;
&lt;/div&gt;

&lt;script&gt;
new Vue({
  el: '#app',
  data: {
    message: 'Hello Vue.js!'
  }
})
&lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;</textarea>
            </div>
        </div>

        <div class="panel panel-default" style="width:100%; margin-bottom:0">
            <!--<div class="panel-heading">-->
            <!--<form class="form-inline">-->
            <!--<button type="button" class="btn btn-default">运行结果</button>-->
            <!--</form>-->
            <!--</div>-->
            <div id="doc2git--output--panel-body" style="position:relative;" class="panel-body">
                <span style="position:absolute; right:20px; color:#ccc; font-size:14px;">&lt;&lt; 运行结果</span>
                <div style="height: 240px;" id="iframewrapper"></div>
            </div>
        </div>
    </div>

</div>

<footer>
    <div class="row">
        <div class="col-sm-12">
            <div style="text-align: center;">

                <hr>

                <p>Copyright © 2013-2017<a target="_blank" href="//doc2git.com/">&nbsp;&nbsp;doc2git.com</a></p>
            </div>
        </div>
    </div>
</footer>

<!--<script>-->
<!--var mixedMode = {-->
<!--name: "htmlmixed",-->
<!--scriptTypes: [{-->
<!--matches: /\/x-handlebars-template|\/x-mustache/i,-->
<!--mode: null-->
<!--},-->
<!--{-->
<!--matches: /(text|application)\/(x-)?vb(a|script)/i,-->
<!--mode: "vbscript"-->
<!--}]-->
<!--};-->
<!--var editor = CodeMirror.fromTextArea(document.getElementById("textareaCode"), {-->
<!--mode: mixedMode,-->
<!--selectionPointer: true,-->
<!--lineNumbers: false,-->
<!--matchBrackets: true,-->
<!--indentUnit: 4,-->
<!--indentWithTabs: true-->
<!--});-->

<!--window.addEventListener("resize", autodivheight);-->

<!--var x = 0;-->

<!--function autodivheight() {-->
<!--var winHeight = 0;-->
<!--if (window.innerHeight) {-->
<!--winHeight = window.innerHeight;-->
<!--} else if ((document.body) && (document.body.clientHeight)) {-->
<!--winHeight = document.body.clientHeight;-->
<!--}-->
<!--//通过深入Document内部对body进行检测，获取浏览器窗口高度-->
<!--if (document.documentElement && document.documentElement.clientHeight) {-->
<!--winHeight = document.documentElement.clientHeight;-->
<!--}-->
<!--height = winHeight * 0.68;-->
<!--editor.setSize('100%', height);-->
<!--document.getElementById("iframeResult").style.height = height + "px";-->
<!--doc2git_textareaReRender();-->
<!--doc2git_OutputReRender();-->
<!--doc2git_leftRightBoxKeepDimension();-->
<!--doc2git_textareaBoxKeepWidth()-->
<!--}-->

<!--function submitTryit() {-->
<!--var text = editor.getValue();-->
<!--var patternHtml = /<html[^>]*>((.|[\n\r])*)<\/html>/im-->
<!--var patternHead = /<head[^>]*>((.|[\n\r])*)<\/head>/im-->
<!--var array_matches_head = patternHead.exec(text);-->
<!--var patternBody = /<body[^>]*>((.|[\n\r])*)<\/body>/im;-->

<!--var array_matches_body = patternBody.exec(text);-->
<!--var basepath_flag = 1;-->
<!--var basepath = '';-->
<!--if (basepath_flag) {-->
<!--//            basepath = '<base href="//www.runoob.com/try/demo_source/" target="_blank">';-->
<!--}-->
<!--if (array_matches_head) {-->
<!--text = text.replace('<head>', '<head>' + basepath);-->
<!--} else if (patternHtml) {-->
<!--text = text.replace('<html>', '<head>' + basepath + '</head>');-->
<!--} else if (array_matches_body) {-->
<!--text = text.replace('<body>', '<body>' + basepath);-->
<!--} else {-->
<!--text = basepath + text;-->
<!--}-->
<!--var ifr = document.createElement("iframe");-->
<!--ifr.setAttribute("frameborder", "0");-->
<!--ifr.setAttribute("id", "iframeResult");-->
<!--document.getElementById("iframewrapper").innerHTML = "";-->
<!--document.getElementById("iframewrapper").appendChild(ifr);-->

<!--var ifrw = (ifr.contentWindow) ? ifr.contentWindow : (ifr.contentDocument.document) ? ifr.contentDocument.document : ifr.contentDocument;-->
<!--ifrw.document.open();-->
<!--ifrw.document.write(text);-->
<!--ifrw.document.close();-->
<!--autodivheight();-->
<!--}-->

<!--submitTryit();-->
<!--autodivheight();-->
<!--</script>-->

<div style="display:none;">
    <!--<script>-->
    <!--var _hmt = _hmt || [];-->
    <!--(function () {-->
    <!--var hm = document.createElement("script");-->
    <!--hm.src = "//hm.baidu.com/hm.js?8e2a116daf0104a78d601f40a45c75b4";-->
    <!--var s = document.getElementsByTagName("script")[0];-->
    <!--s.parentNode.insertBefore(hm, s);-->
    <!--})();-->
    <!--</script>-->
</div>
<!--Bellow code attemp to get the output iframe and hack its height, but when output was changing , the height will resume, so this idea is worse.-->
</body>
</html>
<script data-hacker="doc2git">
    //    doc2git_textareaDimension();
</script>
